<html>
<head>

<style>

	html, body { width:100%; height:100%; padding: 0; margin: 0; font-family: Tahoma; background: #272822}
	
	h1 { color: white; background: #272822; padding: 10px 10px 0px 10px; background #84ff00; margin:10;}
	pre { }
	
	div.edit {margin:10px;}
	
	div.console {color: white; height: 180px; overflow:auto; margin: 10px; border: 1px solid black; padding: 10px;}
	#code { display:none }
	
	#editor { 
        width: 100%;
		height: 500px;
    }
    
    iframe {display:none;}

</style>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>


<script src="/socket.io/socket.io.js"></script>
<script>
  var socket = io();
  var socketId = null;
  
  function send()
  {
	socket.emit("msg", "AHOJ");
  }
  
  function formSubmit()
  {
	// Clear console
	document.getElementById("console").innerHTML = "";
	
	// Copy data from editor
	document.getElementById("code").value = editor.getValue();
    
    // Copy socket id
    document.getElementById("socketId").value = socketId;
  }
  
  function consolePrint(msg)
  {
    var div = document.getElementById("console");
    //var br = document.createElement("br");
    var content = document.createTextNode(msg + "\n");
    div.appendChild(content);
    //div.appendChild(br);

    var elem = document.getElementById('console_container');
    elem.scrollTop = elem.scrollHeight;
  }
  
  socket.on('connect', function () {
  
    consolePrint("Socket connected: " + socket.io.engine.id);
    //socketId = socket.io.engine.id;
    socketId = socket.id;
  
    socket.on('msg', function(msg){
      consolePrint(msg);
    });
  
  });
  

</script>

</head>
<body>

<h1>Online compiler</h1>

<div id = "editor" >
	#include &lt;application.h&gt;
	#include &lt;usb_talk.h&gt;
	#include &lt;bc_led.h&gt;
	#include &lt;bc_button.h&gt;
	bc_led_t led;
	bc_button_t button;

	void button_event_handler(bc_button_t *self, bc_button_event_t event, void *param)
	{
		(void) self;
		(void) param;
		if (event == BC_BUTTON_EVENT_PRESS)
		{
			static uint16_t event_count = 0;
			bc_led_set_mode(&led, (event_count & 1) != 0 ? BC_LED_MODE_BLINK : BC_LED_MODE_OFF);
			usb_talk_publish_push_button("", &event_count);
			event_count++;
		}
	}

	void application_init(void)
	{
		usb_talk_init();

		bc_led_init(&led, BC_GPIO_LED, false, false);
		bc_led_set_mode(&led, BC_LED_MODE_BLINK);

		bc_button_init(&button, BC_GPIO_BUTTON, BC_GPIO_PULL_DOWN, false);
		bc_button_set_event_handler(&button, button_event_handler, NULL);
	}

</div>

<iframe name="post"></iframe>

<div class="edit">
<form method="post" onsubmit="formSubmit()" target="post">
	<textarea id="code" name="code" >
	</textarea>
    <input type="hidden" id="socketId" name="socketId" />

	<input type="submit" value="Compile"/>
</form>
</div>

<div class="console" id="console_container">
	<pre id="console">
	</pre>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js"></script>

<script>
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.getSession().setMode("ace/mode/c_cpp");
</script>

</body>
</html>